import tkinter as tk
from tkinter import messagebox
import json
from datetime import datetime

FILENAME = "tareas.json"

# Cargar tareas si existen
try:
    with open(FILENAME, "r") as file:
        tareas = json.load(file)
except FileNotFoundError:
    tareas = []

# Guardar tareas en archivo
def guardar_tareas():
    with open(FILENAME, "w") as file:
        json.dump(tareas, file, indent=4)

# A√±adir nueva tarea
def a√±adir_tarea():
    titulo = entry_titulo.get()
    desc = entry_desc.get()
    fecha = entry_fecha.get()
    
    if not titulo or not fecha:
        messagebox.showwarning("Faltan datos", "T√≠tulo y fecha son obligatorios.")
        return
    
    tarea = {
        "titulo": titulo,
        "descripcion": desc,
        "fecha": fecha,
        "completada": False
    }
    tareas.append(tarea)
    guardar_tareas()
    actualizar_lista()
    entry_titulo.delete(0, tk.END)
    entry_desc.delete(0, tk.END)
    entry_fecha.delete(0, tk.END)

# Mostrar tareas guardadas
def actualizar_lista():
    listbox_tareas.delete(0, tk.END)
    for i, t in enumerate(tareas):
        estado = "‚úîÔ∏è" if t["completada"] else "‚ùå"
        listbox_tareas.insert(tk.END, f"{i+1}. {t['titulo']} [{estado}] - {t['fecha']}")

# Eliminar tarea seleccionada
def eliminar_tarea():
    seleccion = listbox_tareas.curselection()
    if not seleccion:
        return
    index = seleccion[0]
    tareas.pop(index)
    guardar_tareas()
    actualizar_lista()

# Marcar como completada
def completar_tarea():
    seleccion = listbox_tareas.curselection()
    if not seleccion:
        return
    index = seleccion[0]
    tareas[index]["completada"] = True
    guardar_tareas()
    actualizar_lista()

# Crear ventana principal
root = tk.Tk()
root.title("Gestor de Tareas üóìÔ∏è")

frame = tk.Frame(root, padx=10, pady=10)
frame.pack()

# Entradas de texto
tk.Label(frame, text="T√≠tulo").grid(row=0, column=0)
entry_titulo = tk.Entry(frame, width=30)
entry_titulo.grid(row=0, column=1)

tk.Label(frame, text="Descripci√≥n").grid(row=1, column=0)
entry_desc = tk.Entry(frame, width=30)
entry_desc.grid(row=1, column=1)

tk.Label(frame, text="Fecha (YYYY-MM-DD)").grid(row=2, column=0)
entry_fecha = tk.Entry(frame, width=30)
entry_fecha.grid(row=2, column=1)

# Botones
btn_a√±adir = tk.Button(frame, text="A√±adir tarea", command=a√±adir_tarea)
btn_a√±adir.grid(row=3, columnspan=2, pady=5)

btn_completar = tk.Button(frame, text="Marcar como completada", command=completar_tarea)
btn_completar.grid(row=4, columnspan=2, pady=5)

btn_eliminar = tk.Button(frame, text="Eliminar tarea", command=eliminar_tarea)
btn_eliminar.grid(row=5, columnspan=2, pady=5)

# Lista visual
listbox_tareas = tk.Listbox(root, width=60)
listbox_tareas.pack(pady=10)

# Mostrar tareas al iniciar
actualizar_lista()

root.mainloop()
